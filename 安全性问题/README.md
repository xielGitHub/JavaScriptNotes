1、HTTP劫持和DNS劫持

DNS劫持：

劫持DNS服务器，取得域名解析记录控制权，篡改域名解析结果，将正常请求导向指定IP(302)。例如导向一个广告页，并将原本访问的页面以iframe的形式插入到广告页中；

HTTP劫持：

通常是运营商劫持，在运营商路由节点上，设置协议检测。当检测到HTTP请求，则拦截处理(通常针对HTML文件)，在正常数据流中插入设计过的数据报文。通常造成2种结果：返回302重定向或者向正常页面中注入js或插入DOM节点(此时若被注入的是恶意代码，也就演变为了XSS攻击)；

前端应对手段：

1）建立劫持上报机制。不同的劫持都可能有其独特的特点，通常前端没有一种通用的方法能应对所有的劫持情况。所以为了让前端的应对手段更加健全，我们需要更多地上报被劫持情况，以供分析出更多的劫持规律，完善前端应对策略。

2）针对内嵌入iframe的情况，通过比较window.top和window.self(window)，可判断是否被内嵌，然后通过操作window.top.location来重定向。需要注意的是，要根据劫持规律采取正确手段来绕过劫持，否则即便重定向了也会再次被劫持(这个时候上报机制就起到了作用)。另外针对正常被嵌入的情况，需要判断宿主页地址(跨域情况window.top.location无法获取，需要通过document.referrer)来建立白名单/黑名单机制。

3）针对被注入代码(通常是脚本)的情况，通过MutationObserver(需要考虑兼容性)或者DOMNodeInserted事件(web标准已废弃)来监听。MutationObserver对于静态注入(页面加载时便以存在于页面之上)和动态注入(动态创建节点注入)都可处理，而DOMNodeInserted则只能处理动态注入的情况。需要注意的是，对于静态注入，MutationObserver可以在其代码执行前发现并移除；但对于动态注入，MutationObserver和DOMNodeInserted事件都只能在其代码执行后起作用，因此此时，只能起到上报的作用。

前端以外的应对手段：

1）终端拦截返回包，对ip进行黑名单/白名单过滤，非正常包则丢弃。通常运营商劫持了HTTP请求后，并不丢弃请求包，而只是复制一份，正常请求仍旧发往服务器，处理过的请求则302直接返回。此时，终端只要丢弃非正常包，稍后便能收到正常包。

2）终端拦截请求包，进行拆包发送。通常运营商劫持，会进行协议检测，判断是否是HTTP请求。一般情况下只会判断TCP连接后的第一个数据包，只有当数据包是一个完整的HTTP协议才会被判断为HTTP请求；否则，因为信息不足，就不会被判断为HTTP请求，那么也就不会被劫持了。

3）使用HTTPS。HTTPS由于SSL层的存在，可以对通信对方(服务器)进行身份校验和数据完整性校验，因此，就不太容易被劫持了。但使用HTTPS成本较大，需要根据业务实际情况来谨慎使用。

2、XSS跨站脚本攻击

XSS一般指向web页面中注入恶意代码，然后恶意代码会在用户访问页面时主动/被动执行，从而达到攻击目的。

XSS要达到攻击目的，必须满足两个条件：

1）向页面内注入代码；

2）代码有机会被浏览器执行；

常见的XSS攻击类型有：

1）反射型。反射型的攻击代码不会被存储在服务器端，通常是作为输入发送到服务器，服务器处理后会将其与响应内容一起返回，从而呈现在页面上。

2）存储刑。存储型的攻击代码会被保存在服务器，当每次载入页面都会从服务器端读到攻击代码，因此存储型的攻击更稳定更持久，危害更大。

前端应对措施：

前面提到XSS攻击需要满足两个条件，因此，应对手段也主要从这两个方面入手。

1）防止代码被注入。

1.1）对输入内容进行过滤。

常见需要过滤的有：

- 对<、>、/、\、"、&等HTML字符进行HTML entity encode；
- 对query string进行URL encode；

需要注意的是，输入内容包括query string及表单提交等，像query string这类的前端无法过滤，所以需要服务端和前端都设有过滤措施。

1.2）重写某些能向页面注入代码的方法。

某些时候，攻击者可能需要通过document.write或者innerHTML等这样的方法来向页面写入代码。所以重新这些方法，加入黑/白名单的判断，可以有效的避免而已代码被注入。

2）防止注入代码被执行。

2.1）使用MutationObserver可以有效的防止恶意的静态静态脚本被执行(对动态脚本无效)；

2.2）在捕获阶段，监听document上的事件。许多攻击脚本可能需要通过用户触发某个事件才能被执行，因此在捕获阶段截获这些事件，可以有效阻止恶意代码执行。

适用情况：

- <a href="javascript:xxx">...</a>;
- <div onclick="javascript:xxx">...</div>

参考：[http://blog.csdn.net/z69183787/article/details/52496188](http://blog.csdn.net/z69183787/article/details/52496188)